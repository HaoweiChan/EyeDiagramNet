# Tests

This directory contains test scripts and utilities for examining and validating the EyeDiagramNet data.

## examine_pickle_data.py

A Python script version of the Jupyter notebook for examining pickle files generated by the training data collector.

### Features

- **Complete Analysis Pipeline**: Loads, examines, and analyzes pickle data
- **Statistical Analysis**: Comprehensive statistics on eye width distributions and parameters
- **Data Quality Validation**: Checks for data integrity and consistency
- **Validation Comparison**: Optional comparison with fresh simulation results
- **Automated Reporting**: Generates summary reports and exports detailed data
- **Visualization**: Creates distribution plots and validation comparison charts

### Usage

#### Basic Usage
```bash
# Basic examination of pickle files
python examine_pickle_data.py --pickle_dir ./data/training_data

# With validation comparison (requires simulation modules)
python examine_pickle_data.py --pickle_dir ./data/training_data --validate

# Limit validation scope for faster execution
python examine_pickle_data.py --pickle_dir ./data/training_data --validate --max_files 2 --max_samples 3
```

#### Command Line Options

- `--pickle_dir PATH`: Path to directory containing pickle files (default: `./data/training_data`)
- `--validate`: Run validation comparison with fresh simulation results
- `--max_files N`: Maximum number of files to validate (default: 3)
- `--max_samples N`: Maximum number of samples per file to validate (default: 5)

### Requirements

#### Basic Analysis
- Python 3.6+
- numpy
- pandas
- matplotlib
- seaborn
- pathlib

#### Validation Features (Optional)
- simulation.engine.sparam_to_ew
- simulation.parameters.bound_param

If validation modules are not available, the script will run in analysis-only mode.

### Output Files

- `training_data_summary.txt`: Comprehensive summary report
- `eye_width_distributions.png`: Eye width distribution plots
- `validation_comparison.png`: Validation comparison plots (if validation enabled)
- `validation_comparison_details.csv`: Detailed validation results (if validation enabled)

### Analysis Sections

1. **Data Loading**: Discovers and loads all pickle files
2. **Structure Analysis**: Examines data structure and content
3. **Statistical Summary**: Aggregates statistics across all files
4. **Distribution Analysis**: Analyzes eye width distributions with plots
5. **Quality Checks**: Validates data integrity and consistency
6. **Validation**: Compares stored vs fresh simulation results (optional)
7. **Final Report**: Generates comprehensive summary

### Example Output

```
EYE DIAGRAM TRAINING DATA EXAMINATION
============================================================

1. LOADING AND EXAMINING PICKLE FILES
========================================
Looking for pickle files in: ./data/training_data
Found 15 pickle files
1. trace1.pkl
2. trace2.pkl
...

Data structure:
  configs: list with 100 items
    First item type: <class 'list'>
    Config length: 45 parameters
  line_ews: list with 100 items
    First item type: <class 'list'>
    Line EW shape: (4,)
  ...
```

### Integration with Main Codebase

This script is designed to work with the EyeDiagramNet repository structure and can validate data against the actual simulation functions used for data generation.

### Troubleshooting

- **No pickle files found**: Check the `--pickle_dir` path
- **Validation unavailable**: Ensure simulation modules are in Python path
- **Plot display issues**: May need to set matplotlib backend for headless systems
- **Memory issues**: Reduce `--max_files` and `--max_samples` for large datasets 